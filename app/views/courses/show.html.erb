<script>
function sortTable(n) {
  var table, rows, switching, i, x, y, shouldSwitch, dir, switchcount = 0;
    table = document.getElementById("sportSessionTable");
    switching = true;
    // Set the sorting direction to ascending:
    dir = "asc";
    /* Make a loop that will continue until
    no switching has been done: */
    while (switching) {
      // Start by saying: no switching is done:
      switching = false;
      rows = table.rows;
      /* Loop through all table rows (except the
      first, which contains table headers): */
      for (i = 1; i < (rows.length - 1); i++) {
      // Start by saying there should be no switching:
        shouldSwitch = false;
        /* Get the two elements you want to compare,
        one from current row and one from the next: */
        x = rows[i].getElementsByTagName("TD")[n];
        y = rows[i + 1].getElementsByTagName("TD")[n];
        /* Check if the two rows should switch place,
        based on the direction, asc or desc: */
        if (dir == "asc") {
          if (x.innerHTML.toLowerCase() > y.innerHTML.toLowerCase()) {
            // If so, mark as a switch and break the loop:
            shouldSwitch = true;
            break;
          }
        } else if (dir == "desc") {
          if (x.innerHTML.toLowerCase() < y.innerHTML.toLowerCase()) {
            // If so, mark as a switch and break the loop:
            shouldSwitch = true;
            break;
          }
        }
      }
      if (shouldSwitch) {
        /* If a switch has been marked, make the switch
        and mark that a switch has been done: */
        rows[i].parentNode.insertBefore(rows[i + 1], rows[i]);
        switching = true;
        // Each time a switch is done, increase this count by 1:
        switchcount ++;
      } else {
        /* If no switching has been done AND the direction is "asc",
        set the direction to "desc" and run the while loop again. */
        if (switchcount == 0 && dir == "asc") {
          dir = "desc";
          switching = true;
        }
      }
    }
  }
</script>
<div class="center" style="width:90%">

  <div style="float:right">
    <%= link_to("delete", 
          course_path(id: @course.id), 
          { data: { turbo_method: :delete }, class: "button-red" }) %>
  </div>

  <div class="flexbox">
    <div class="chart">
      <table class="normaltable" style="width:100%">
        <tr>
          <td style="width:20%">id</td>       <td><%= @course.id %></td>
        </tr>
        <tr>
          <td style="width:50%">name</td>     <td><%= @course.name %></td>
        </tr>
        <tr>
          <td style="width:20%">distance</td> <td><%= @course.distance %></td>
        </tr>
        <tr>
          <td style="width:10%">session#</td> <td><%= @course.session_ids&.count %></td>
        </tr>
      </table>
    </div>
    
    <div class="chart">
      <%= line_chart @assigned_sessions_durations %>
    </div>

  </div>

  <div>
    Assigned Sessions: <p/>
  <% if @assigned_sessions.count > 0 %>
    <table class="normaltable" style="width:100%" id="sportSessionTable">
      <tr>
        <th style="width:20%">id</th>
        <th style="width:15%" onclick="sortTable(1)">started</th>
        <th style="width:10%">sport</th>
        <th style="width:10%" onclick="sortTable(3)">distance [km]</th>
        <th style="width:10%" onclick="sortTable(4)">duration [hh:mm]</th>
        <th style="width:10%">elevation gain/loss</th>
        <th style="width:30%">notes</th>
        <th style=width:"5%">&nbsp;</th>
      </tr>
    <% @assigned_sessions.each do |session| %>
      <tr>
        <td><%= session.id %></td>
        <td><%= session.start_time %></td>
        <td><%= session.sport_type %></td>
        <td><%= session.distance_in_km %></td>
        <td><%= session.duration_as_str %></td>
        <td><%= session.elevation %></td>
        <td><%= session.notes %></td>
        <td><%= link_to("remove", 
            course_session_path(course_id: @course.id, id: session.id), 
            { data: { confirm: 'Are you sure?',
            turbo_method: :delete }, class: "button-red" }) %></td>
      </tr>
    <% end %>
    </table>
  <% end %>
  </div>
    
  <div>
  <% if @matching_sessions.count > 0 %>
    Matching Sessions: <p/>
    <div style="float:right">
      <%= link_to("add all", 
            course_add_all_matching_sessions_path(course_id: @course.id), 
            { data: { turbo_method: :post }, class: "button-green" }) %>
    </div>
    <table class="normaltable" style="width:100%">
      <tr>
        <th style="width:20%">id</th>
        <th style="width:15%">started</th>
        <th style="width:10%">sport</th>
        <th style="width:10%">distance [km]</th>
        <th style="width:10%">duration [hh:mm]</th>
        <th style="width:10%">elevation gain/loss</th>
        <th style="width:25%">notes</th>
        <th style="width:5%">match rate</th>
        <th style="width:5%">&nbsp;</th>
      </tr>
      <% @matching_sessions.each do |hash|
         session = hash[:session]
      %>
        <tr>
          <td><%= session.id %></td>
          <td><%= session.start_time %></td>
          <td><%= session.sport_type %></td>
          <td><%= session.distance_in_km %></td>
          <td><%= session.duration_as_str %></td>
          <td><%= session.elevation %></td>
          <td><%= session.notes %></td>
          <td><%= hash[:match_rate] %></td>
          <td><%= link_to("add", 
              course_session_index_path(course_id: @course.id, id: session.id), 
              { data: { turbo_method: :post }, class: "button-green" }) %></td>
        </tr>
      <% end %>
    </table>
  <% end %>
  </div>
</div>
