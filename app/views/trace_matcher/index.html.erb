<% content_for :for_head do -%>
  <%= javascript_include_tag('jquery.js') %>
  <%= javascript_include_tag('jquery.flot.js') %>

	<script type="text/javascript">

    function plotmygraph() {

      var d1 = <%= @matcher.blocks1 %>;
      var d2 = <%= @matcher.blocks2 %>;

      $.plot("#placeholder", [ d1, d2 ]);
    };

    // Window.onload = function() {  
    //   plotmygraph();
    // };

    document.addEventListener("DOMContentLoaded", function() {
      plotmygraph();
    });

    // $(document).ready( function () {
    //   plotmygraph()
    // });

	</script> 
<% end -%>

<div class="flexbox">
  <%= form_with url: "/trace_matcher", method: :get do |form| %>
  <div id="block-div">
    <table>
      <tr>
        <td class="smalltd"><%= form.label :text, "block_size: " %></td>
        <td class="smalltd"><%= form.number_field :block_size, value: @match_params[:block_size] %></td>
      </tr>
      <tr>
        <td class="smalltd"><%= form.label :text, "max diff: " %></td>
        <td class="smalltd"><%= form.number_field :max_diff, value: @match_params[:max_diff] %></td>
      </tr>
      <tr>
        <td class="smalltd"><%= form.label :text, "min overlap: " %></td>
        <td class="smalltd"><%= form.number_field :min_overlap, value: @match_params[:min_overlap], in: 0.0..1.0, step: 0.01 %></td>
      </tr>
      <tr><td colspan=2 class="smalltd"><%= form.submit "Apply" %></td></tr>
    </table>
  </div>
  <div id="block2-div">
    <table>
      <tr>
        <td class="smalltd"><%= form.label :text, "session 1: " %></td>
        <td class="smalltd"><%= form.text_field :session1, value: @match_params[:session1] %></td>
      </tr>
      <tr>
        <td class="smalltd"><%= form.label :text, "session 2: " %></td>
        <td class="smalltd"><%= form.text_field :session2, value: @match_params[:session2] %></td>
      </tr>
    </table>
  </div>
  <% end %>

  <div id="block-div">
    Match?: <%= @matcher.matching? %><br/>
    Match rate: <%= @matcher.match_in_percent %>
  </div>
</div>

<div id="placeholder" style="width:1600px;height:700px"></div>

<script type="text/javascript">
    plotmygraph();
</script>
